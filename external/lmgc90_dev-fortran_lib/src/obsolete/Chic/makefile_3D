# This is part of LMGC90-v0.0 by F.Dubois & M.Jean (c) 2001 CNRS-UMII 
#
TOP=
FC=
LIBS=
LIBS_PATH=
FFLAGS=

# retrouver Core
LMGC90_CORE=$(TOP)/../Core

SHARED=$(TOP)/src/shared
RIGID3D=$(TOP)/src/rigid_3D
MAILx=$(TOP)/src/mailx
CONTACT3D=$(TOP)/src/contact_3D
KERNEL=$(TOP)/src/kernel
POST=$(TOP)/src/post


.PHONY: info wrap_shared wrap_rigid_3D wrap_mailx wrap_contact_3D wrap_kernel_3D wrap_post_3D clean

# construction de l'executable 

lmgc90: info wrap_shared wrap_rigid_3D wrap_mailx wrap_contact_3D wrap_kernel_3D wrap_post_3D
	$(FC) -o lmgc90_3D$(PLAT) $(FFLAGS) src/JMNR_3D.f90 \
	$(SHARED)/wrap_shared.a $(RIGID3D)/wrap_rigid_3D.a \
	$(MAILx)/wrap_mailx.a $(CONTACT3D)/wrap_contact_3D.a \
	$(KERNEL)/wrap_kernel_3D.a $(POST)/wrap_post_3D.a \
	$(LMGC90_CORE)/lib/post_3D.a $(LMGC90_CORE)/lib/kernel_3D.a \
        $(LMGC90_CORE)/lib/rigid_3D.a $(LMGC90_CORE)/lib/mailx.a $(LMGC90_CORE)/lib/contact_3D.a \
        $(LMGC90_CORE)/lib/shared.a $(LMGC90_CORE)/lib/gmvwrite.a $(LMGC90_CORE)/lib/vtkwrite.a \
        $(LMGC90_CORE)/lib/bindings.a \
	$(LIBS_PATH) $(LIBS)

info:
	@echo "#############################"
	@echo "option de l edition de lien :" $(FFLAGS) 
	@echo "#############################"

wrap_shared:
	cd $(SHARED); \
	make -e -f makefile "FC=$(FC)" "FFLAGS=$(FFLAGS)" "CHICFLAGS=$(FFLAGS)" wrap_shared.a

wrap_rigid_3D:
	cd $(RIGID3D); \
	make -e -f makefile "FC=$(FC)" "FFLAGS=$(FFLAGS)" wrap_rigid_3D.a

wrap_mailx:
	cd $(MAILx); \
	make -e -f makefile "FC=$(FC)" "FFLAGS=$(FFLAGS)" wrap_mailx.a

wrap_contact_3D:
	cd $(CONTACT3D); \
	make -e -f makefile "FC=$(FC)" "FFLAGS=$(FFLAGS)" wrap_contact_3D.a

wrap_kernel_3D:
	cd $(KERNEL); \
	make -e -f makefile "FC=$(FC)" "FFLAGS=$(FFLAGS)" wrap_kernel_3D.a

wrap_post_3D:
	cd $(POST); \
	make -e -f makefile "FC=$(FC)" "FFLAGS=$(FFLAGS)" wrap_post_3D.a
# menage

clean:
	@echo "#########################"
	@echo "On nettoie les sources"
	@rm -f lmgc90_3D* *.o 
	@cd $(POST);\
	make -f makefile clean
	@cd $(KERNEL);\
	make -f makefile clean
	@cd $(SHARED);\
	make -f makefile clean
	@cd $(MAILx);\
	make -f makefile clean
	@cd $(CONTACT3D);\
	make -f makefile clean
	@cd $(RIGID3D);\
	make -f makefile clean
	@echo "#########################"

